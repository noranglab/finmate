<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FinMate - 간편장부 (개선판)</title>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      margin: 0; padding: 16px; font-family: 'Inter', 'Noto Sans KR', sans-serif;
      background-color: #0A0F1D; color: #E8EAED; line-height: 1.5;
    }
    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 24px;
    }
    .header-title { font-size: clamp(20px, 5vw, 24px); font-weight: 700; }
    .back-link {
      color: #34D399; text-decoration: none;
      font-size: clamp(14px, 3.8vw, 16px); font-weight: 500;
    }
    
    /* 월별 현황 카드 */
    .summary-card {
        background: linear-gradient(145deg, #1E293B 0%, #111827 100%);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 24px;
    }
    .month-selector {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 16px;
    }
    .month-selector button {
        background: none; border: none; color: #E8EAED;
        font-size: 24px; cursor: pointer;
    }
    .current-month {
        font-size: clamp(18px, 5vw, 20px);
        font-weight: 600;
        margin: 0 20px;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        text-align: center;
    }
    .stat-item .label {
        font-size: 13px;
        color: #8B8F98;
        margin-bottom: 4px;
    }
    .stat-item .value {
        font-size: 16px;
        font-weight: 600;
    }
    .value-income { color: #34D399; }
    .value-expense { color: #F87171; }
    
    /* 입력 폼 */
    .input-form-card {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 24px;
    }
    .form-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
    }
    .form-group {
        margin-bottom: 12px;
    }
    .form-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 6px;
        color: #8B8F98;
    }
    .form-group input {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid #4A5568;
        border-radius: 8px;
        padding: 10px 12px;
        color: #E8EAED;
        width: 100%;
        font-size: 15px;
        font-family: 'Inter', 'Noto Sans KR', sans-serif;
    }
    .form-row {
        display: flex;
        gap: 12px;
    }
    .form-row .form-group {
        flex: 1;
    }
    .submit-btn {
        background-color: #34D399;
        color: #1A1F2E;
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 8px;
    }

    /* 거래 내역 리스트 */
    .daily-group .date-header {
        color: #8B8F98;
        font-weight: 600;
        margin-top: 24px;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .daily-group:first-child .date-header {
        margin-top: 8px; /* 첫 번째 그룹의 상단 마진 제거 */
    }
    .transaction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 10px;
    }
    .transaction-details {
        flex: 1;
    }
    .transaction-description {
        font-weight: 500;
    }
    .transaction-amounts {
        text-align: right;
        margin-right: 16px;
    }
    .amount-income {
        font-weight: 600;
        color: #34D399;
    }
    .amount-expense {
        font-weight: 600;
        color: #F87171;
    }
    .delete-btn {
        background: #4A5568;
        color: #E8EAED;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        font-weight: bold;
        cursor: pointer;
        line-height: 24px;
        text-align: center;
    }
    .no-transaction {
        text-align: center; color: #8B8F98; padding: 40px 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 class="header-title">간편장부</h1>
    <a href="/finmate/ui/finmate_main.html" class="back-link">← 돌아가기</a>
  </div>

  <div class="summary-card">
    <div class="month-selector">
      <button id="prev-month">‹</button>
      <div id="current-month" class="current-month"></div>
      <button id="next-month">›</button>
    </div>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="label">총수입</div>
        <div id="total-income" class="value value-income">0 원</div>
      </div>
      <div class="stat-item">
        <div class="label">총비용</div>
        <div id="total-expense" class="value value-expense">0 원</div>
      </div>
      <div class="stat-item">
        <div class="label">합계</div>
        <div id="total-sum" class="value">0 원</div>
      </div>
    </div>
  </div>

  <div class="input-form-card">
    <h2 class="form-title">거래 등록하기</h2>
    <form id="transaction-form">
      <div class="form-group">
        <label for="date">날짜</label>
        <input type="date" id="date" required>
      </div>
      <div class="form-group">
        <label for="description">내용</label>
        <input type="text" id="description" placeholder="거래 내용을 입력하세요" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="income">수입</label>
          <input type="number" id="income" placeholder="0">
        </div>
        <div class="form-group">
          <label for="expense">비용</label>
          <input type="number" id="expense" placeholder="0">
        </div>
      </div>
      <button type="submit" class="submit-btn">등록하기</button>
    </form>
  </div>

  <div id="transaction-list-container">
    </div>

  <script>
    // --- Initial State ---
    let currentDate = new Date('2025-08-10');
    let transactions = [
        { id: 1, date: '2025-08-05', description: 'A사 디자인 용역 대금', income: 2500000, expense: 0 },
        { id: 2, date: '2025-08-08', description: '업무용 소프트웨어 구독', income: 0, expense: 35000 },
        { id: 3, date: '2025-07-20', description: 'B사 컨설팅 비용', income: 1500000, expense: 0 },
        { id: 4, date: '2025-08-10', description: '교통비 (클라이언트 미팅)', income: 0, expense: 25000 },
        { id: 5, date: '2025-08-10', description: '점심 식대', income: 0, expense: 12000 },
    ];

    // --- DOM Elements ---
    const dom = {
        currentMonth: document.getElementById('current-month'),
        prevMonthBtn: document.getElementById('prev-month'),
        nextMonthBtn: document.getElementById('next-month'),
        totalIncome: document.getElementById('total-income'),
        totalExpense: document.getElementById('total-expense'),
        totalSum: document.getElementById('total-sum'),
        form: document.getElementById('transaction-form'),
        dateInput: document.getElementById('date'),
        listContainer: document.getElementById('transaction-list-container'),
    };

    // --- Functions ---
    const formatCurrency = (num) => `${num.toLocaleString()} 원`;

    const render = () => {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        dom.currentMonth.textContent = `${year}년 ${month + 1}월`;

        const monthlyTransactions = transactions.filter(tx => {
            const txDate = new Date(tx.date);
            return txDate.getFullYear() === year && txDate.getMonth() === month;
        });

        // Group transactions by date
        const grouped = monthlyTransactions.reduce((acc, tx) => {
            (acc[tx.date] = acc[tx.date] || []).push(tx);
            return acc;
        }, {});

        const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));

        dom.listContainer.innerHTML = '';
        if (sortedDates.length === 0) {
            dom.listContainer.innerHTML = '<p class="no-transaction">해당 월에 등록된 거래가 없습니다.</p>';
        } else {
            sortedDates.forEach(date => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'daily-group';
                
                const dateHeader = document.createElement('h3');
                dateHeader.className = 'date-header';
                dateHeader.textContent = date;
                groupDiv.appendChild(dateHeader);

                grouped[date].forEach(tx => {
                    const item = document.createElement('div');
                    item.className = 'transaction-item';
                    item.innerHTML = `
                        <div class="transaction-details">
                            <div class="transaction-description">${tx.description}</div>
                        </div>
                        <div class="transaction-amounts">
                            ${tx.income > 0 ? `<div class="amount-income">+ ${formatCurrency(tx.income)}</div>` : ''}
                            ${tx.expense > 0 ? `<div class="amount-expense">- ${formatCurrency(tx.expense)}</div>` : ''}
                        </div>
                        <button class="delete-btn" data-id="${tx.id}">&times;</button>
                    `;
                    groupDiv.appendChild(item);
                });
                dom.listContainer.appendChild(groupDiv);
            });
        }
        
        // Update summary
        const income = monthlyTransactions.reduce((sum, tx) => sum + tx.income, 0);
        const expense = monthlyTransactions.reduce((sum, tx) => sum + tx.expense, 0);
        const sum = income - expense;
        
        dom.totalIncome.textContent = formatCurrency(income);
        dom.totalExpense.textContent = formatCurrency(expense);
        dom.totalSum.textContent = formatCurrency(sum);
        dom.totalSum.style.color = sum >= 0 ? '#E8EAED' : '#F87171';
    };

    const deleteTransaction = (id) => {
        transactions = transactions.filter(tx => tx.id !== id);
        render();
    };

    // --- Event Handlers ---
    dom.listContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-btn')) {
            const transactionId = Number(e.target.dataset.id);
            deleteTransaction(transactionId);
        }
    });

    dom.form.addEventListener('submit', (e) => {
        e.preventDefault();
        const newTransaction = {
            id: Date.now(),
            date: dom.dateInput.value,
            description: e.target.elements.description.value.trim(),
            income: Number(e.target.elements.income.value) || 0,
            expense: Number(e.target.elements.expense.value) || 0,
        };
        
        if (!newTransaction.date || !newTransaction.description) {
            alert('날짜와 내용을 모두 입력해주세요.');
            return;
        }
        if (newTransaction.income === 0 && newTransaction.expense === 0) {
            alert('수입 또는 비용 중 하나는 반드시 입력해야 합니다.');
            return;
        }

        transactions.push(newTransaction);
        e.target.reset();
        dom.dateInput.valueAsDate = new Date(newTransaction.date); // Keep the entered date's month
        currentDate = new Date(newTransaction.date);
        render();
    });

    dom.prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        render();
    });

    dom.nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        render();
    });

    // --- Initial Load ---
    dom.dateInput.valueAsDate = new Date(); // Set default date to today
    render();
  </script>
</body>
</html>
